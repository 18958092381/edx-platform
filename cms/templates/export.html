<%inherit file="base.html" />
<%namespace name='static' file='static_content.html'/>

<%! from django.core.urlresolvers import reverse %>
<%block name="title">Export</%block>
<%block name="bodyclass">export</%block>

<%block name="content">
<div class="main-wrapper">
  <div class="inner-wrapper">
    <article class="export-overview">
      <div class="description">
        <h2>Export course to a .tar.gz file</h2>
        <p>When exporting your course with this method, you will receive a .tar.gz formatted file that contains the following course data:</p>

        <ul>
          <li>Course Structure (Sections and sub-section ordering)</li>
          <li>Individual Units</li>
          <li>Individual Problems</li>
          <li>Static Pages</li>
          <li>Course Assets</li>
        </ul>

        <p>Your course export <strong>will not include</strong>: student data, forum/discussion data, course settings, certificates, grading information, or user data.</p>
      </div>

      <!-- default state -->
      <div class="export-form-wrapper">
        <form action="${reverse('generate_export_course', kwargs=dict(org=context_course.location.org, course=context_course.location.course, name=context_course.location.name))}" method="post" enctype="multipart/form-data" class="export-form">
          <h2>Export Course to .tar.gz:</h2>
          
          <p class="error-block"></p>
          
          <a href="${reverse('generate_export_course', kwargs=dict(org=context_course.location.org, course=context_course.location.course, name=context_course.location.name))}" class="button-export">Download Files</a>
        </form>
      </div>

      <!-- download state: after user clicks download buttons -->
      <%doc>
      <div class="export-form-wrapper is-downloading">
        <form action="${reverse('export_course', kwargs=dict(org=context_course.location.org, course=context_course.location.course, name=context_course.location.name))}" method="post" enctype="multipart/form-data" class="export-form" id="tgzexport">
          <h2>Export Course:</h2>
          
          <p class="error-block"></p>
          
          <a href="#" class="button-export disabled">Files Downloading</a>
          <p class="message-status">Download not start? <a href="#" class="text-export">Try again</a></p>          
        </form>
      </div>
      </%doc>
    </article>
  </div>

% if settings.MITX_FEATURES['GITHUB_EXPORT_AND_INPORT']:
  <div class="inner-wrapper">
    <article class="export-overview">
      <div class="description">
        <h2>Export a course to a github repository</h2>
        <p><strong>The exported course content will be stored in a
specific branch of a github repository for the course.</strong></p>
      </div>

      <div class="export-form-wrapper">
       <form action="${reverse('export_course', kwargs=dict(org=context_course.location.org, course=context_course.location.course, name=context_course.location.name))}" method="post" enctype="multipart/form-data" class="export-form">
       <p>
        <ul>
          <li>git repository location (ssh): <input type="text" size="55" name="git_repo" value="${git_repo}"></li>
          <li>branch to use: <input type="text" size="55" name="git_branch" value="${git_branch}"></li>
	</ul>
<!--        <input type="submit" name="submit" value="Set Git
Repository Info" class="submit-button"> -->
       </p>
       <br/>
       <p>
        <input type="submit" name="submit" value="Export to Github Repository" class="submit-button">
	<input type="hidden" name="csrfmiddlewaretoken" value="${ csrf_token }">
       </p>
       </form>
      </div>

      % if message:
      <br/>
      <p class="error-block">
      <hr width="100%"><pre>${message|h}</pre><hr width="100%">
      </p>
      % endif

    </article>
  </div>
%endif

</div>
</%block>

<%block name="jsextra">
<script>

(function() {
    
var bar = $('.progress-bar');
var fill = $('.progress-fill');
var percent = $('.percent');
var status = $('#status');
var submitBtn = $('.submit-button');
   
$('#tgzexport').ajaxForm({
    beforeSend: function() {
        status.empty();
        var percentVal = '0%';
        bar.show();
        fill.width(percentVal);
        percent.html(percentVal);
        submitBtn.hide();
    },
    uploadProgress: function(event, position, total, percentComplete) {
        var percentVal = percentComplete + '%';
        fill.width(percentVal);
        percent.html(percentVal);
    },
    complete: function(xhr) {
      if (xhr.status == 200) {
        alert('Your import was successful.');
        window.location = '${successful_import_redirect_url}';
      }
      else
        alert('Your import has failed.\n\n' + xhr.responseText);
        submitBtn.show();
        bar.hide();
    }
  }); 
})();       
</script>
</%block>
